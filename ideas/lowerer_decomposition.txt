Lowerer Decomposition Plan
===========================

Goal: Break up the ~30-field Lowerer god struct into focused sub-structs.

COMPLETED:
- Commit 1: Consolidate FunctionMeta parallel HashMaps into FuncSig struct
  (10 parallel HashMaps replaced with HashMap<String, FuncSig> + ptr_sigs)
- Commit 2: Extract FunctionBuildState from Lowerer
  (17 per-function fields moved into FunctionBuildState sub-struct,
   Lowerer holds Option<FunctionBuildState> — None between functions,
   ~150 access sites updated, func()/func_mut() accessors added)
- Commit 3: Extract TypeContext from Lowerer
  (6 type-system fields moved into TypeContext sub-struct:
   struct_layouts, typedefs, function_typedefs, enum_constants,
   ctype_cache, func_return_ctypes. Lowerer holds TypeContext field.
   ~67 access sites updated across 13 files. pop_scope and
   insert_enum_scoped updated to go through self.types.)
- Commit 4: Move scope undo tracking into TypeContext and FunctionBuildState
  (ScopeFrame split into TypeScopeFrame and FuncScopeFrame.
   TypeContext owns scope_stack for enum_constants/struct_layouts/ctype_cache
   undo tracking with push_scope/pop_scope/insert_*_scoped methods.
   FunctionBuildState owns scope_stack for locals/statics/consts/var_ctypes
   undo tracking with push_scope/pop_scope/insert_*_scoped/shadow_*_for_scope.
   Lowerer's push_scope/pop_scope delegates to both sub-structs.
   structs.rs insert_struct_layout_scoped/invalidate_ctype_cache_scoped
   now delegate to TypeContext methods.)

- Commit 5: CType::Struct(Arc<StructType>) -> CType::Struct(String)
  (CType::Struct and CType::Union now hold a String key instead of
   Arc<StructType>. TypeContext is the sole owner of struct/union
   layouts via struct_layouts HashMap. StructType removed entirely.
   Added StructLayoutProvider trait in common/types.rs for
   decoupled layout lookup. CType gains size_ctx/align_ctx methods
   taking &dyn StructLayoutProvider. StructLayout::for_struct_with_packing
   and for_union now take &dyn StructLayoutProvider for nested type
   resolution. SemaResult gains struct_layouts field. ~100 pattern
   match sites updated across 14 files. resolve_forward_declared_ctype
   and resolve_ctype_size simplified to key-based lookups.
   Eliminates the entire class of forward-declaration staleness bugs.)

- Commit 6: Typedefs become HashMap<String, CType>
  (TypeContext.typedefs changed from HashMap<String, TypeSpecifier> to
   HashMap<String, CType>. resolve_type_spec no longer follows TypedefName
   chains -- type_spec_to_ctype is now the primary typedef resolution path.
   Typedef scope tracking with undo logs added to TypeScopeFrame.
   seed_builtin_typedefs inserts CType values directly.
   Added CType-based type query helpers: is_type_bool, is_type_complex,
   is_type_struct_or_union, is_type_pointer, is_type_array, resolve_type_to_ctype.
   ~30 resolve_type_spec call sites updated to use CType resolution.
   Fixed CType::size() -> size_ctx()/resolve_ctype_size() for struct/union
   element sizing in array subscript, struct init, and global init paths.
   13 files changed, ~600 insertions, ~378 deletions.)

- Commit 7: Sema populates TypeContext
  (SemaResult now contains a TypeContext field instead of separate typedefs/
   enum_constants/struct_layouts HashMaps. SemanticAnalyzer populates the
   TypeContext during its AST walk: typedefs (including function typedefs and
   function pointer typedefs), enum constants, and struct/union layouts.
   TypeContext, TypeScopeFrame, and FunctionTypedefInfo made pub and re-exported
   from ir::lowering module. Lowerer::with_type_context(target, TypeContext)
   constructor added — driver passes sema's TypeContext to the lowerer.
   Sema's type_spec_to_ctype fixed to not overwrite full struct definitions
   with forward declaration stubs. Sema's convert_struct_fields updated to
   use build_full_ctype for correct function-pointer-array field handling.
   Debug assertions verify sema/lowerer agreement on named struct layouts
   and enum constants. Only known gap: sema's eval_const_expr cannot evaluate
   offsetof() expressions, so enum constants derived from offsetof differ.
   5 files changed, ~200 insertions, ~30 deletions.)

- Commit 8: Lowerer receives TypeContext from sema
  (Removed the lowerer's pass-0 collect_all_enum_constants() and
   collect_all_typedefs() calls from lower(). The lowerer now trusts
   sema's pre-populated TypeContext for all file-scope typedefs, enum
   constants, struct/union layouts, function typedefs, and function
   pointer typedefs. Removed the debug assertion snapshots that verified
   sema/lowerer agreement (no longer needed since we trust sema).
   seed_builtin_typedefs() and seed_libc_math_functions() kept because
   they are target-dependent and sema doesn't know the compilation target.
   Function signature collection (register_function_meta) kept because
   sema's FunctionInfo uses CTypes while the lowerer needs IrType-based
   FuncSig entries in func_meta for ABI/calling convention decisions.
   collect_all_enum_constants and collect_all_typedefs are now dead code
   (to be removed in commit 9). 1 file changed.)

- Commit 9: Delete dead code and workarounds
  (Deleted collect_all_typedefs, collect_all_enum_constants, extract_func_typedef_info,
   Lowerer::new(), and Default for Lowerer — all dead after commit 8 made sema
   the authority for file-scope type info. Lowerer::with_type_context() is now
   the only constructor. Stale NOTE comment about previously removed functions
   deleted. README updated to remove extract_func_typedef_info reference.
   resolve_ctype_size and resolve_forward_declared_ctype kept — still actively
   used (40+ call sites across 7 files). SemaResult already clean (only has
   type_context field, no duplicate typedefs/enum_constants/struct_layouts).
   TypeSpecifier conversion helpers (resolve_type_spec, ctype_to_type_spec,
   sizeof_type, type_spec_to_ir) kept — still actively used (15-30+ call sites
   each). These will be candidates for future cleanup when more lowering paths
   are migrated to CType-native resolution. 3 files changed, pure deletion.)

- Commit 10: Remove global #![allow(dead_code)] and fix what it reveals
  (Removed #![allow(dead_code, unused_variables, unused_imports, unreachable_patterns)]
   from lib.rs. Fixed 6 unused imports (removed), 13 unused variables (prefixed with _),
   1 unreachable pattern (removed), 12 dead functions/methods (deleted):
   resolve_typedef_derived, insert_var_ctype_scoped (2x: FunctionBuildState + Lowerer),
   resolve_type_to_ctype, is_type_array, fill_nested_designator_composite,
   collect_ptr_ranges_from_nested_init, collect_ptr_ranges_from_struct_init_list,
   resolve_struct_init_field, resolve_member_access_chain, find_type_at_member_chain,
   ldr_for_type, load_dest_reg. Build is now warning-free. Pure cleanup.)

ALL 10 COMMITS COMPLETE. The lowerer decomposition is finished.
