Lowerer Decomposition Plan
===========================

Goal: Break up the ~30-field Lowerer god struct into focused sub-structs.

COMPLETED:
- Commit 1: Consolidate FunctionMeta parallel HashMaps into FuncSig struct
  (10 parallel HashMaps replaced with HashMap<String, FuncSig> + ptr_sigs)
- Commit 2: Extract FunctionBuildState from Lowerer
  (17 per-function fields moved into FunctionBuildState sub-struct,
   Lowerer holds Option<FunctionBuildState> â€” None between functions,
   ~150 access sites updated, func()/func_mut() accessors added)
- Commit 3: Extract TypeContext from Lowerer
  (6 type-system fields moved into TypeContext sub-struct:
   struct_layouts, typedefs, function_typedefs, enum_constants,
   ctype_cache, func_return_ctypes. Lowerer holds TypeContext field.
   ~67 access sites updated across 13 files. pop_scope and
   insert_enum_scoped updated to go through self.types.)
- Commit 4: Move scope undo tracking into TypeContext and FunctionBuildState
  (ScopeFrame split into TypeScopeFrame and FuncScopeFrame.
   TypeContext owns scope_stack for enum_constants/struct_layouts/ctype_cache
   undo tracking with push_scope/pop_scope/insert_*_scoped methods.
   FunctionBuildState owns scope_stack for locals/statics/consts/var_ctypes
   undo tracking with push_scope/pop_scope/insert_*_scoped/shadow_*_for_scope.
   Lowerer's push_scope/pop_scope delegates to both sub-structs.
   structs.rs insert_struct_layout_scoped/invalidate_ctype_cache_scoped
   now delegate to TypeContext methods.)

- Commit 5: CType::Struct(Arc<StructType>) -> CType::Struct(String)
  (CType::Struct and CType::Union now hold a String key instead of
   Arc<StructType>. TypeContext is the sole owner of struct/union
   layouts via struct_layouts HashMap. StructType removed entirely.
   Added StructLayoutProvider trait in common/types.rs for
   decoupled layout lookup. CType gains size_ctx/align_ctx methods
   taking &dyn StructLayoutProvider. StructLayout::for_struct_with_packing
   and for_union now take &dyn StructLayoutProvider for nested type
   resolution. SemaResult gains struct_layouts field. ~100 pattern
   match sites updated across 14 files. resolve_forward_declared_ctype
   and resolve_ctype_size simplified to key-based lookups.
   Eliminates the entire class of forward-declaration staleness bugs.)

REMAINING (in order):

5. Typedefs become HashMap<String, CType>
   - Delete TypeSpecifier conversion layer
   - Risk: Medium

6-8. Sema populates TypeContext / Lowerer receives it from sema
   - Make sema the authority for type information
   - Risk: Medium-high
