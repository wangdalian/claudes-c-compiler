Status: in_progress
Worker: pid-$$
Start: 2026-01-28
---
Fix mem2reg to promote InlineAsm output allocas to SSA registers.

Problem: When an alloca is used as an InlineAsm output pointer, mem2reg
disqualifies it from promotion. This causes stack spills between consecutive
inline asm blocks. In the Linux kernel's set_satp_mode(), this creates a
page fault because the stack is not identity-mapped when MMU is briefly
enabled between csr_write and csr_swap.

Root cause: InlineAsm outputs are stored as (constraint, alloca_ptr, name)
in the IR. The alloca pointer appears in InlineAsm::used_values(), causing
mem2reg to disqualify it (it's neither a Load nor Store).

Fix: Teach mem2reg to treat InlineAsm output pointers as store definitions
rather than disqualifying uses, and handle them during SSA renaming.
